#!/usr/bin/env node


'use strict';

var _assert = require('assert');

var _assert2 = _interopRequireDefault(_assert);

var _yargs = require('yargs');

var _yargs2 = _interopRequireDefault(_yargs);

var _binHelper = require('../bin-helper');

var _binHelper2 = _interopRequireDefault(_binHelper);

var _options = require('mocha/bin/options');

var _options2 = _interopRequireDefault(_options);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// support --opts
// getOptions() changes process.argv
(0, _options2.default)();

const argv = _yargs2.default.parse(process.argv);
(0, _assert2.default)(argv._.length > 2, 'No test files found');

(0, _binHelper2.default)(argv).then(failsOccured => {
    // wait for reporter to finish its operations
    // exit with code equal to number of failed tests
    process.nextTick(() => {
        if (argv.exit === undefined) {
            process.exit(failsOccured);
        } else {
            // if --no-exit argv is present wait for exit event
            process.on('exit', () => {
                process.exit(failsOccured);
            });
        }
    });
});
